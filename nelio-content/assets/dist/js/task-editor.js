(()=>{var e,t={6734:(e,t,s)=>{"use strict";s.r(t),s.d(t,{taskEditor:()=>i});var n={};s.r(n),s.d(n,{getAssigneeId:()=>k,getAttributes:()=>m,getColor:()=>j,getCustomOnSave:()=>A,getDateType:()=>y,getDateValue:()=>T,getEditorContext:()=>w,getId:()=>_,getPost:()=>E,getPostId:()=>D,getRelatedPostStatus:()=>P,getTask:()=>v,getValidationError:()=>N,isDirty:()=>C,isNewTask:()=>f,isSaving:()=>O,isVisible:()=>S});var a={};s.r(a),s.d(a,{close:()=>G,markAsSaving:()=>Y,openExistingTaskEditor:()=>q,openNewTaskEditor:()=>M,setAssigneeId:()=>I,setColor:()=>L,setDateType:()=>R,setDateValue:()=>$,setPost:()=>U,setRelatedPostStatus:()=>F,setTask:()=>V,setValidationError:()=>K});var o={};s.r(o),s.d(o,{saveAndClose:()=>X});var i={};s.r(i),s.d(i,{TaskEditor:()=>De,store:()=>Q});const l=window.ReactJSXRuntime,r=window.wp.components,c=window.wp.data;function d(e,t){return(0,c.useSelect)(e,t)}const u=window.wp.i18n,p=window.NelioContent.components,g={task:"",dateType:"predefined-offset",dateValue:"0",color:"none",completed:!1},x={context:"calendar",error:"",isNewTask:!1,isSaving:!1,isVisible:!1,relatedPost:{post:void 0,status:"none"},source:{color:"none",completed:!1,dateType:"predefined-offset",dateValue:"0",task:""},onSave:void 0};const b=window.lodash,h=(0,c.combineReducers)({attributes:function(e=g,t){var s;return null!==(s=function(e,t){switch(t.type){case"OPEN_EDITOR":return Object.assign(Object.assign({},g),t.task);case"SET_TASK":return Object.assign(Object.assign({},e),{task:t.task});case"SET_ASSIGNEE_ID":return Object.assign(Object.assign({},e),{assigneeId:t.assigneeId});case"SET_DATE_TYPE":return Object.assign(Object.assign({},e),{dateType:t.dateType});case"SET_DATE_VALUE":return Object.assign(Object.assign({},e),{dateValue:(s=t.dateValue,void 0===s?"":`${s}`)});case"SET_COLOR":return Object.assign(Object.assign({},e),{color:t.color})}var s}(e,t))&&void 0!==s?s:e},status:function(e=x,t){var s;return null!==(s=function(e,t){switch(t.type){case"OPEN_EDITOR":return Object.assign(Object.assign({},x),{context:t.options.context,isNewTask:t.isNewTask,isVisible:!0,relatedPost:{post:t.options.post,status:t.options.post?"ready":"none"},source:t.task,onSave:t.options.onSave});case"CLOSE_EDITOR":return x;case"SET_POST":return t.post?Object.assign(Object.assign({},e),{relatedPost:Object.assign(Object.assign({},e.relatedPost),{post:t.post})}):Object.assign(Object.assign({},e),{relatedPost:(0,b.omit)(e.relatedPost,"post")});case"SET_RELATED_POST_STATUS":return Object.assign(Object.assign({},e),{relatedPost:Object.assign(Object.assign({},e.relatedPost),{status:t.status})});case"SET_VALIDATION_ERROR":return Object.assign(Object.assign({},e),{error:t.error});case"MARK_AS_SAVING":return Object.assign(Object.assign({},e),{isSaving:!!t.isSaving})}}(e,t))&&void 0!==s?s:e}});function _(e){return e.attributes.id}function v(e){return e.attributes.task}function k(e){return e.attributes.assigneeId}function y(e){return e.attributes.dateType}function T(e){return e.attributes.dateValue}function j(e){return e.attributes.color}function m(e){return e.attributes}function f(e){return!!e.status.isNewTask}function S(e){return!!e.status.isVisible}function O(e){return!!e.status.isSaving}function N(e){return e.status.error}function E(e){return e.status.relatedPost.post}function D(e){var t;return null===(t=e.status.relatedPost.post)||void 0===t?void 0:t.id}function P(e){return e.status.relatedPost.status}function w(e){return e.status.context}function C(e){const{source:t}=e.status,{attributes:s}=e,n=(null==t?void 0:t.task)!==s.task||(null==t?void 0:t.assigneeId)!==s.assigneeId||(null==t?void 0:t.dateType)!==s.dateType||(null==t?void 0:t.dateValue)!==s.dateValue||(null==t?void 0:t.color)!==s.color;return!e.status.isNewTask&&n}function A(e){return e.status.onSave}function V(e){return{type:"SET_TASK",task:e}}function I(e){return{type:"SET_ASSIGNEE_ID",assigneeId:e}}function R(e){return{type:"SET_DATE_TYPE",dateType:e}}function $(e){return{type:"SET_DATE_VALUE",dateValue:e}}function L(e){return{type:"SET_COLOR",color:e}}const B=window.NelioContent.utils;function q(e,t){return{type:"OPEN_EDITOR",task:e,isNewTask:!1,options:t}}function M(e,t){return{type:"OPEN_EDITOR",task:Object.assign(Object.assign({},(0,B.createTask)()),(0,b.omitBy)(e,b.isNil)),isNewTask:!0,options:t}}function U(e){return{type:"SET_POST",post:e}}function G(){return{type:"CLOSE_EDITOR"}}function F(e){return{type:"SET_RELATED_POST_STATUS",status:e}}function K(e){return{type:"SET_VALIDATION_ERROR",error:e}}function Y(e){return{type:"MARK_AS_SAVING",isSaving:e}}const z=window.wp.apiFetch,H=s.n(z)(),J=window.NelioContent.data;var W=function(e,t,s,n){return new(s||(s=Promise))(function(a,o){function i(e){try{r(n.next(e))}catch(e){o(e)}}function l(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}r((n=n.apply(e,t||[])).next())})};function X(){return W(this,void 0,void 0,function*(){if((0,c.select)(Q).isSaving())return;yield(0,c.dispatch)(Q).markAsSaving(!0);const e=(0,c.select)(Q).getPost(),t=(0,c.select)(Q).getAttributes(),s=Object.assign(Object.assign(Object.assign({},(0,B.createTask)()),t),{postId:null==e?void 0:e.id,postType:null==e?void 0:e.type,postAuthor:null==e?void 0:e.author,dateDue:(0,B.getTaskDateDue)({baseDatetime:e&&"publish"!==e.status&&e.date?e.date:"now",dateType:t.dateType,dateValue:t.dateValue})}),n=(0,c.select)(Q).getCustomOnSave();if(n)return n(s),yield(0,c.dispatch)(Q).markAsSaving(!1),void(yield(0,c.dispatch)(Q).close());try{const t=(0,c.select)(J.store).getSiteId(),n=(0,c.select)(J.store).getApiRoot(),a=(0,c.select)(J.store).getAuthenticationToken(),o=(0,c.select)(Q).isNewTask(),i=o?"POST":"PUT",l=!o&&s.id?`${n}/site/${t}/task/${s.id}`:`${n}/site/${t}/task`,r=yield H({url:l,method:i,credentials:"omit",mode:"cors",headers:{Authorization:`Bearer ${a}`},data:Object.assign(Object.assign({},s),{baseDatetime:o?(0,B.getBaseDatetime)(e,s.dateType):"reschedule"})});yield(0,c.dispatch)(J.store).receiveTasks(r);try{yield H({path:"/nelio-content/v1/notifications/task",method:"POST",data:Object.assign({isNewTask:o},r)})}catch(e){}}catch(e){(0,B.logError)(e)}yield(0,c.dispatch)(Q).markAsSaving(!1),yield(0,c.dispatch)(Q).close()})}const Q=(0,c.createReduxStore)("nelio-content/task-editor",{reducer:h,controls:c.controls,actions:Object.assign(Object.assign({},a),o),selectors:n});!function(e){(0,c.register)(e)}(Q);const Z=[{title:(0,u._x)("Task Editor","text","nelio-content"),intro:(0,u._x)("Welcome to the task editor. Create and assign tasks to the authors of your blog and make sure you keep track of everything that matters.","user","nelio-content")},{title:(0,u._x)("Task Editor","text","nelio-content"),intro:(0,u._x)("Tasks are actually quite simple. They consist of a description of the task itself, which you can type in here.","user","nelio-content"),element:()=>document.querySelector(".nelio-content-task-editor__actual-task")},{title:(0,u._x)("Assignee","text","nelio-content"),intro:(0,u._x)("The assignee (that is, the person responsible of doing this task) can also be found and selected here.","user","nelio-content"),active:()=>!!document.querySelector(".nelio-content-task-editor__assignee"),element:()=>document.querySelector(".nelio-content-task-editor__assignee")},{title:(0,u._x)("Due Date","text","nelio-content"),intro:(0,u._x)("And the expected deadline can be set here.","user","nelio-content"),active:()=>!!document.querySelector(".nelio-content-task-editor__date-due"),element:()=>document.querySelector(".nelio-content-task-editor__date-due")},{title:(0,u._x)("Task Colors","text","nelio-content"),intro:(0,u._x)("Finally, you can optionally assign a color to the task to easily tell it appart from the others.","user","nelio-content"),active:()=>!!document.querySelector(".nelio-content-task-editor__colors"),element:()=>document.querySelector(".nelio-content-task-editor__colors")}],ee=({disabled:e})=>{const[t,s]=te();return se()?(0,l.jsx)("div",{className:"nelio-content-task-editor__assignee",children:(0,l.jsx)(p.AuthorSearcher,{disabled:e,value:t,onChange:s,placeholder:(0,u._x)("Assign task to…","command","nelio-content")})}):null},te=()=>{const e=d(e=>e(Q).getAssigneeId()),{setAssigneeId:t}=(0,c.useDispatch)(Q);return[e,t]},se=()=>d(e=>e(J.store).isMultiAuthor),ne=({dateValue:e,disabled:t,setDateType:s,setDateValue:n})=>(0,l.jsx)(r.SelectControl,{className:"nelio-content-task-editor-date-due__default-select",disabled:t,options:oe,value:e,onChange:e=>{ae(e)?(s(e),n("")):n(e)}}),ae=e=>["positive-days","negative-days","exact"].includes(e),oe=[{value:"0",label:(0,u._x)("Same day as publication","text","nelio-content")},{value:"-1",label:(0,u._x)("The day before publication","text","nelio-content")},{value:"-7",label:(0,u._x)("A week before publication","text","nelio-content")},{value:"negative-days",label:(0,u._x)("__ days before publication","text","nelio-content")},{value:"positive-days",label:(0,u._x)("__ days after publication","text","nelio-content")},{value:"exact",label:(0,u._x)("Choose a custom date…","user","nelio-content")}],ie=({disabled:e})=>{const{setDateType:t,setDateValue:s}=(0,c.useDispatch)(Q);return(0,l.jsx)("div",{className:"nelio-content-task-editor-date-due__back-button",children:(0,l.jsx)(r.Button,{variant:"link",disabled:e,onClick:()=>{t("predefined-offset"),s("0")},children:(0,u._x)("Back","command","nelio-content")})})},le=({disabled:e,dateValue:t,hasBackButton:s,setDateValue:n})=>(0,l.jsxs)("div",{className:"nelio-content-task-editor-date-due__exact-date",children:[(0,l.jsx)(p.DateInput,{className:"nelio-content-task-editor-date-due__exact-date-input",disabled:e,value:t,onChange:e=>n(null!=e?e:"")}),!!s&&(0,l.jsx)(ie,{disabled:e})]}),re=({disabled:e,dateValue:t,setDateValue:s})=>(0,l.jsxs)("div",{className:"nelio-content-task-editor-date-due__days-offset",children:[(0,l.jsx)(p.NumberControl,{className:"nelio-content-task-editor-date-due__days-input",disabled:e,placeholder:(0,u._x)("Days before publication…","text","nelio-content"),min:2,value:t,onChange:e=>s(ce(e))}),(0,l.jsx)(ie,{disabled:e})]}),ce=e=>void 0===e?"":`${e}`,de=({disabled:e,dateValue:t,setDateValue:s})=>(0,l.jsxs)("div",{className:"nelio-content-task-editor-date-due__days-offset",children:[(0,l.jsx)(p.NumberControl,{className:"nelio-content-task-editor-date-due__days-input",disabled:e,placeholder:(0,u._x)("Days after publication…","text","nelio-content"),min:1,value:t,onChange:e=>s(ue(e))}),(0,l.jsx)(ie,{disabled:e})]}),ue=e=>void 0===e?"":`${e}`,pe=({disabled:e})=>{const[t,s]=ge(),[n,a]=xe(),o=be(),i="nelio-content-task-editor-date-due nelio-content-task-editor__date-due";return"negative-days"===t?(0,l.jsx)("div",{className:i,children:(0,l.jsx)(re,{disabled:e,dateValue:n,setDateValue:a})}):"positive-days"===t?(0,l.jsx)("div",{className:i,children:(0,l.jsx)(de,{disabled:e,dateValue:n,setDateValue:a})}):"exact"!==t&&o?(0,l.jsx)("div",{className:i,children:(0,l.jsx)(ne,{disabled:e,dateValue:n,setDateValue:a,setDateType:s})}):(0,l.jsx)("div",{className:i,children:(0,l.jsx)(le,{disabled:e,hasBackButton:o,dateValue:n,setDateValue:a})})},ge=()=>{const e=d(e=>e(Q).getDateType()),{setDateType:t}=(0,c.useDispatch)(Q);return[e,t]},xe=()=>{const e=d(e=>e(Q).getDateValue()),{setDateValue:t}=(0,c.useDispatch)(Q);return[e,t]},be=()=>{const e=d(e=>e(Q).getPost());return!!e&&"publish"!==e.status},he=window.wp.element,_e=()=>{const e=d(e=>e(Q).getAssigneeId()),t=d(e=>e(Q).getDateType()),s=d(e=>e(Q).getDateValue()),n=d(e=>e(Q).getTask()),{setValidationError:a}=(0,c.useDispatch)(Q);return(0,he.useEffect)(ve(()=>(0,b.trim)(n)?a(e?s?"":(0,u._x)("Please specify a date","user","nelio-content"):(0,u._x)("Please assign the task to someone","user","nelio-content")):a((0,u._x)("Please enter a task","user","nelio-content"))),[e,t,s,n]),null},ve=e=>()=>{e()},ke=()=>{const e=d(e=>e(Q).getPost()),{setPost:t}=(0,c.useDispatch)(Q);return[e,d(e=>s=>{const n=e(J.store).getPost(s);n&&t(n)})]},ye=()=>d(e=>e(Q).getRelatedPostStatus()),Te=({disabled:e})=>{const t="nelio-content-task-editor__related-post-controls",[s,n]=ke(),a=d(e=>e(Q).getPostId()),o=d(e=>{const t=e(Q).getEditorContext(),s=!e(Q).isNewTask(),n="none"!==e(Q).getRelatedPostStatus();return"calendar"!==t||s&&!n}),i=(()=>{const e=d(e=>{const t=!e(Q).isNewTask();return"calendar"===e(Q).getEditorContext()&&t}),t=d(e=>{var t,s;const n=null===(t=e(Q).getAttributes())||void 0===t?void 0:t.id;return null===(s=e(J.store).getTask(n))||void 0===s?void 0:s.postId}),{post:s,isLoadingPost:n}=d(s=>{const n=e&&t?s(J.store).getPost(t):void 0;return{post:n,isLoadingPost:e&&!!t&&!n&&!s(J.store).hasFinishedResolution("getPost",[t])}}),{setPost:a,setRelatedPostStatus:o}=(0,c.useDispatch)(Q);return(0,he.useEffect)(()=>{e&&(n?o("loading"):s?(a(s),o("ready")):o(t?"error":"none"))},[e,n,t,s,a,o]),e&&!!t})(),g=ye(),{setRelatedPostStatus:x}=(0,c.useDispatch)(Q),h=(0,b.map)((0,J.usePostTypes)("tasks"),"name"),_=(0,J.usePostStatuses)();return i?(0,l.jsx)(je,{className:t}):o||!h.length?(0,l.jsx)("div",{className:t}):"none"===g?(0,l.jsx)("div",{className:t,children:(0,l.jsx)(r.Button,{variant:"link",disabled:e,onClick:()=>x("searcher"),children:(0,u._x)("Select related post…","command","nelio-content")})}):"searcher"===g?(0,l.jsx)("div",{className:t,children:(0,l.jsx)(p.PostSearcher,{disabled:e,value:a,onChange:e=>{e&&n(e)},postTypes:h,postStatuses:_})}):(0,l.jsx)("div",{className:t})},je=({className:e})=>{const[t]=ke(),s=ye();return"none"===s?(0,l.jsx)("div",{className:e}):"loading"===s?(0,l.jsx)("div",{className:e,children:"Loading..."}):"error"!==s&&t?(0,l.jsxs)("div",{className:`${e} ${e}--has-related-post-link`,children:[(0,l.jsx)("strong",{children:(0,u._x)("Related Post:","text","nelio-content")+" "}),(0,l.jsx)(r.ExternalLink,{href:t.viewLink,children:(0,l.jsx)("span",{className:"nelio-content-related-post-link",children:t.title})})]}):(0,l.jsxs)("div",{className:`${e} ${e}--has-related-post-link`,children:[(0,l.jsx)("strong",{children:(0,u._x)("Related Post:","text","nelio-content")+" "}),(0,l.jsx)("span",{children:(0,u._x)("Not Found","text (post)","nelio-content")})]})},me=({color:e,disabled:t,label:s,selected:n,onChange:a})=>(0,l.jsxs)("li",{className:`nelio-content-task-colors__option nelio-content-task-colors__option--is-${e}`,children:[(0,l.jsx)("input",{disabled:t,type:"checkbox",checked:!!n,onChange:e=>a(!!e.target.checked),title:s})," ",(0,l.jsx)("span",{className:"screen-reader-text",children:s})]}),fe=({className:e="",disabled:t})=>{const[s,n]=Se();return(0,l.jsxs)("div",{className:`nelio-content-task-colors ${e}`,children:[(0,l.jsx)("p",{className:"screen-reader-text",children:(0,u._x)("Select a color:","user","nelio-content")}),(0,l.jsx)("ul",{className:"nelio-content-task-colors__list",children:Oe.map(({value:e,label:a})=>(0,l.jsx)(me,{disabled:t,color:e,label:a,selected:s===e,onChange:t=>n(t?e:"none")},e))})]})},Se=()=>{const e=d(e=>e(Q).getColor()),{setColor:t}=(0,c.useDispatch)(Q);return[e,t]},Oe=[{value:"red",label:(0,u._x)("Red","text","nelio-content")},{value:"orange",label:(0,u._x)("Orange","text","nelio-content")},{value:"yellow",label:(0,u._x)("Yellow","text","nelio-content")},{value:"green",label:(0,u._x)("Green","text","nelio-content")},{value:"cyan",label:(0,u._x)("Cyan","text","nelio-content")},{value:"blue",label:(0,u._x)("Blue","text","nelio-content")},{value:"purple",label:(0,u._x)("Purple","text","nelio-content")}],Ne=({disabled:e})=>{const[t,s]=Ee();return(0,l.jsx)("div",{className:"nelio-content-task-editor__actual-task",children:(0,l.jsx)(r.TextareaControl,{disabled:e,value:t,onChange:e=>s(e),placeholder:(0,u._x)("Describe the task…","user","nelio-content")})})},Ee=()=>{const e=d(e=>e(Q).getTask()),{setTask:t}=(0,c.useDispatch)(Q);return[e,t]},De=({className:e=""})=>{const t=d(e=>e(Q).getValidationError()),s=d(e=>e(Q).isVisible()),n=d(e=>e(Q).isSaving()),a=d(e=>!e(Q).isNewTask()),o=d(e=>e(Q).isDirty()),{close:i,saveAndClose:g}=(0,c.useDispatch)(Q),x=(0,l.jsx)(Pe,{});return s?(0,l.jsxs)(r.Modal,{className:`nelio-content-task-editor ${e}`,title:x,isDismissible:!1,shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,onRequestClose:()=>{},children:[(0,l.jsx)(_e,{}),(0,l.jsx)(Ne,{disabled:n}),(0,l.jsxs)("div",{className:"nelio-content-task-editor__options",children:[(0,l.jsx)(ee,{disabled:n}),(0,l.jsx)(pe,{disabled:n})]}),(0,l.jsx)(Te,{disabled:n}),(0,l.jsx)(fe,{className:"nelio-content-task-editor__colors",disabled:n}),(0,l.jsxs)("div",{className:"nelio-content-task-editor__actions",children:[(0,l.jsx)(r.Button,{variant:"secondary",disabled:n,onClick:i,children:o?(0,u._x)("Discard Changes","command","nelio-content"):(0,u._x)("Close","command","nelio-content")}),(0,l.jsx)(p.SaveButton,{variant:"primary",error:t,disabled:!!a&&!o,isUpdate:a,isSaving:n,onClick:g})]})]}):null},Pe=()=>{const e=d(e=>e(Q).isNewTask());return(0,l.jsxs)("div",{className:"nelio-content-task-editor__title",children:[(0,l.jsx)("div",{className:"nelio-content-task-editor__title-text",children:e?(0,u._x)("Create Task","text","nelio-content"):(0,u._x)("Edit Task","text","nelio-content")}),(0,l.jsx)("div",{className:"nelio-content-task-editor__title-help",children:(0,l.jsx)(p.ContextualHelp,{context:"task-editor",walkthrough:Z,autostart:!0})})]})}}},s={};function n(e){var a=s[e];if(void 0!==a)return a.exports;var o=s[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,s,a,o)=>{if(!s){var i=1/0;for(d=0;d<e.length;d++){for(var[s,a,o]=e[d],l=!0,r=0;r<s.length;r++)(!1&o||i>=o)&&Object.keys(n.O).every(e=>n.O[e](s[r]))?s.splice(r--,1):(l=!1,o<i&&(i=o));if(l){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,a,o]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1234:0,7529:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var a,o,[i,l,r]=s,c=0;if(i.some(t=>0!==e[t])){for(a in l)n.o(l,a)&&(n.m[a]=l[a]);if(r)var d=r(n)}for(t&&t(s);c<i.length;c++)o=i[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},s=globalThis.webpackChunkNelioContent=globalThis.webpackChunkNelioContent||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=n.O(void 0,[7529],()=>n(6734));a=n.O(a);var o=NelioContent="undefined"==typeof NelioContent?{}:NelioContent;for(var i in a)o[i]=a[i];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();