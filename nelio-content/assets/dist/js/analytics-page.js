(()=>{var t,e={5785:(t,e,n)=>{"use strict";n.r(e),n.d(e,{initPage:()=>ft});var o={};n.r(o),n.d(o,{arePostsFullyLoaded:()=>O,arePostsWithCriteriaFullyLoaded:()=>P,getAuthorFilter:()=>_,getFilterCriteria:()=>x,getNextPageToLoad:()=>C,getPeriodFilterMode:()=>y,getPeriodFilterValue:()=>v,getPostIds:()=>T,getPostIdsMatchingCriteria:()=>j,getPostTypeFilter:()=>f,getSortingCriterion:()=>h,isLoadingPosts:()=>N,isLoadingPostsWithCriteria:()=>b});var s={};n.r(s),n.d(s,{markFilterCriteriaAsLoading:()=>F,receivePostsMatchingCriteria:()=>S,setAuthorFilter:()=>A,setPeriodFilter:()=>I,setPostTypeFilter:()=>E,sortBy:()=>w,updateFilterCriteriaPagination:()=>R});var i={};n.r(i),n.d(i,{loadPosts:()=>D});const a=window.ReactJSXRuntime,r=window.wp.data;function l(t,e){return(0,r.useSelect)(t,e)}const c=window.wp.element,d=window.NelioContent.data,u=window.lodash;function p(t){const{sortBy:e,author:n="nc-all-authors",postType:o="nc-all-types",periodMode:s,periodValue:i}=t;return`${e},${"custom"===s?`${i.from}>${i.to}`:s},${n},${o}`}const m={sortBy:"pageviews",filters:{author:void 0,period:{mode:"all-time",value:{from:"",to:""}},postType:void 0},status:{loading:[],pagination:{}},postsByCriteria:{}},g=window.NelioContent.utils;function h(t){return t.sortBy}function y(t){return t.filters.period.mode}function v(t){return t.filters.period.value}function _(t){return t.filters.author}function f(t){return t.filters.postType}function x(t){return{sortBy:h(t),author:_(t),postType:f(t),periodMode:y(t),periodValue:v(t)}}function j(t,e){return t.postsByCriteria[p(e)]||[]}function b(t,e){return t.status.loading.includes(p(e))}function P(t,e){const n=t.status.pagination[p(e)];return!(0,g.isEmpty)(n)&&!!n.isFullyLoaded}function C(t,e){var n;const o=t.status.pagination[p(e)];return(null!==(n=null==o?void 0:o.lastLoadedPage)&&void 0!==n?n:0)+1}function T(t){return j(t,x(t))}function N(t){return b(t,x(t))}function O(t){return P(t,x(t))}function w(t){return{type:"SORT_BY",criterion:t}}function I(t,e){return{type:"SET_PERIOD_FILTER",mode:t,value:e}}function A(t){return{type:"SET_AUTHOR_FILTER",author:t}}function E(t){return{type:"SET_POST_TYPE_FILTER",postType:t}}function S(t,e){return{type:"RECEIVE_POSTS_MATCHING_CRITERIA",criteria:t,posts:e}}function F(t,e){return{type:"MARK_FILTER_CRITERIA_AS_LOADING",criteria:t,isLoading:e}}function R(t,e){return{type:"UPDATE_FILTER_CRITERIA_PAGINATION",criteria:t,pagination:e}}const L=window.wp.apiFetch,M=n.n(L)(),B=window.wp.url;var k=function(t,e,n,o){return new(n||(n=Promise))(function(s,i){function a(t){try{l(o.next(t))}catch(t){i(t)}}function r(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,r)}l((o=o.apply(t,e||[])).next())})};function D(){return k(this,void 0,void 0,function*(){const t=(0,r.select)(Y).getFilterCriteria(),{periodMode:e,periodValue:n}=t;if(!("custom"!==e||n.from&&n.to))return;if((0,r.select)(Y).arePostsWithCriteriaFullyLoaded(t))return;if((0,r.select)(Y).isLoadingPostsWithCriteria(t))return;yield(0,r.dispatch)(Y).markFilterCriteriaAsLoading(t,!0);const o=(0,r.select)(Y).getNextPageToLoad(t);try{const{sortBy:e,author:s,postType:i}=t,a=yield M({path:(0,B.addQueryArgs)("/nelio-content/v1/analytics/top-posts",{sortBy:e,from:n.from||void 0,to:n.to||void 0,author:s||void 0,postType:"_nc-all"!==i?i:void 0,perPage:10,page:o})});yield(0,r.dispatch)(d.store).receivePosts(a.results),yield(0,r.dispatch)(Y).receivePostsMatchingCriteria(t,a.results),yield(0,r.dispatch)(Y).updateFilterCriteriaPagination(t,{lastLoadedPage:o,isFullyLoaded:!a.pagination.more})}catch(t){yield(0,g.showErrorNotice)(t)}yield(0,r.dispatch)(Y).markFilterCriteriaAsLoading(t,!1)})}const Y=(0,r.createReduxStore)("nelio-content/analytics",{reducer:function(t=m,e){var n;return null!==(n=function(t,e){switch(e.type){case"SORT_BY":return Object.assign(Object.assign({},t),{sortBy:e.criterion});case"SET_PERIOD_FILTER":return Object.assign(Object.assign({},t),{filters:Object.assign(Object.assign({},t.filters),{period:{mode:e.mode,value:e.value}})});case"SET_AUTHOR_FILTER":return Object.assign(Object.assign({},t),{filters:Object.assign(Object.assign({},t.filters),{author:e.author})});case"SET_POST_TYPE_FILTER":return Object.assign(Object.assign({},t),{filters:Object.assign(Object.assign({},t.filters),{postType:e.postType})});case"MARK_FILTER_CRITERIA_AS_LOADING":return Object.assign(Object.assign({},t),{status:Object.assign(Object.assign({},t.status),{loading:e.isLoading?(0,u.uniq)([...t.status.loading,p(e.criteria)]):(0,u.without)(t.status.loading,p(e.criteria))})});case"UPDATE_FILTER_CRITERIA_PAGINATION":return Object.assign(Object.assign({},t),{status:Object.assign(Object.assign({},t.status),{pagination:Object.assign(Object.assign({},t.status.pagination),{[p(e.criteria)]:e.pagination})})});case"RECEIVE_POSTS_MATCHING_CRITERIA":const n=t.postsByCriteria[p(e.criteria)]||[];return Object.assign(Object.assign({},t),{postsByCriteria:Object.assign(Object.assign({},t.postsByCriteria),{[p(e.criteria)]:[...n,...(0,u.map)(e.posts,"id")]})})}}(t,e))&&void 0!==n?n:t},controls:r.controls,actions:Object.assign(Object.assign({},s),i),selectors:o});!function(t){(0,r.register)(t)}(Y);const $=window.wp.components,q=window.wp.i18n,G=window.NelioContent.components,V=window.NelioContent.socialMessageEditor,U=window.moment;var H=n.n(U);const W=window.NelioContent.date,K=({mode:t,from:e,to:n,onChange:o})=>{const s=(0,d.useUtcNow)(),i=(0,d.useToday)();return"custom"===t?(0,a.jsxs)("div",{style:{alignItems:"center",display:"flex"},children:[(0,a.jsx)(G.DateInput,{value:e,max:i,onChange:(e="")=>{let s="";e<n&&(s=n),e===i&&(s=i),o({mode:t,value:{from:e,to:s}})}}),(0,a.jsx)(G.DateInput,{value:n,min:e,max:i,onChange:(n="")=>{o({mode:t,value:{from:e,to:e&&e>n?"":n}})}}),(0,a.jsxs)($.Button,{variant:"link",onClick:()=>o({mode:"all-time",value:{from:"",to:""}}),children:[(0,a.jsx)("span",{className:"screen-reader-text",children:(0,q._x)("Back","command","nelio-content")}),(0,a.jsx)($.Dashicon,{icon:"undo"})]})]}):(0,a.jsx)($.SelectControl,{options:Q,value:t,onChange:t=>{switch(t){case"month-to-date":return o({mode:t,value:{from:(0,W.date)("Y-m",s)+"-01",to:(0,W.date)("Y-m-d",s)}});case"last-30-days":return o({mode:t,value:{from:(0,W.date)("Y-m-d",H()(s).add(-30,"days")),to:(0,W.date)("Y-m-d",s)}});case"year-to-date":return o({mode:t,value:{from:(0,W.date)("Y",s)+"-01-01",to:(0,W.date)("Y-m-d",s)}});case"last-12-months":return o({mode:t,value:{from:(0,W.date)("Y-m-d",H()(s).add(-12,"months")),to:(0,W.date)("Y-m-d",s)}});case"custom":const e=n||s;return o({mode:t,value:{from:(0,W.date)("Y",e)+"-01-01",to:(0,W.date)("Y-m-d",e)}});default:return o({mode:"all-time",value:{from:"",to:""}})}}})},Q=[{value:"all-time",label:(0,q._x)("All Time","text","nelio-content")},{value:"month-to-date",label:(0,q._x)("Month to date","text","nelio-content")},{value:"last-30-days",label:(0,q._x)("Last 30 days","text","nelio-content")},{value:"year-to-date",label:(0,q._x)("Year to date","text","nelio-content")},{value:"last-12-months",label:(0,q._x)("Last 12 months","text","nelio-content")},{value:"custom",label:(0,q._x)("Custom Period","text","nelio-content")}],z=({value:t,onChange:e})=>{const n=(0,d.usePostTypes)("analytics"),o=[{value:"__nc-all__",label:(0,q._x)("All Content","text","nelio-content")},...n.map(t=>({value:t.name,label:t.labels.plural}))];return(0,a.jsx)($.SelectControl,{options:o,value:t,onChange:t=>e("__nc-all__"===t?void 0:t)})},J=()=>{const t=l(t=>t(Y).getFilterCriteria()),e=l(t=>t(d.store).isMultiAuthor()),n=1<(0,d.usePostTypes)("analytics").length,{author:o,postType:s,periodMode:i,periodValue:r}=t,c=X(),u=Z(),p=tt();return(0,a.jsxs)("div",{className:"nelio-content-analytics-post-filter",children:[(0,a.jsx)("div",{className:"nelio-content-analytics-post-filter__criterion",children:(0,a.jsx)(K,{mode:i,from:r.from,to:r.to,onChange:u})}),e&&(0,a.jsx)("div",{className:"nelio-content-analytics-post-filter__criterion",children:(0,a.jsx)(G.AuthorSearcher,{value:o,onChange:c,hasAllAuthors:!0})}),n&&(0,a.jsx)("div",{className:"nelio-content-analytics-post-filter__criterion",children:(0,a.jsx)(z,{value:s,onChange:p})})]})},X=()=>{const{loadPosts:t,setAuthorFilter:e}=(0,r.useDispatch)(Y);return n=>{e(n),t()}},Z=()=>{const[{fn:t},e]=(0,c.useState)({fn:ot}),{loadPosts:n,setPeriodFilter:o}=(0,r.useDispatch)(Y);return(0,c.useEffect)(()=>{ot===t&&e({fn:(0,u.debounce)(()=>{n()},600)})},[t]),({mode:e,value:s})=>{if(o(e,s),"custom"!==e||nt(s))return"custom"===e?t():n()}},tt=()=>{const{loadPosts:t,setPostTypeFilter:e}=(0,r.useDispatch)(Y);return n=>{e(n),t()}},et=/^\d{4}-\d{2}-\d{2}$/,nt=({from:t="",to:e=""})=>et.test(t)&&et.test(e),ot=(0,u.debounce)(()=>new Promise(t=>t()),0);function st(t){var e,n,o="";if("string"==typeof t||"number"==typeof t)o+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=st(t[e]))&&(o&&(o+=" "),o+=n)}else for(n in t)t[n]&&(o&&(o+=" "),o+=n);return o}const it=function(){for(var t,e,n=0,o="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=st(t))&&(o&&(o+=" "),o+=e);return o},at=({className:t,postId:e})=>{const n=rt(e),o=lt(e),{published:s,total:i}=ct(e),r=dt(e);return n?(0,a.jsx)("div",{className:`nelio-content-analytics-social-queue nelio-content-analytics-social-queue--is-loading ${t}`,children:(0,a.jsx)($.Spinner,{})}):(0,a.jsxs)("div",{className:`nelio-content-analytics-social-queue ${t}`,children:[(0,a.jsxs)("div",{className:"nelio-content-analytics-social-queue__title",children:[(0,q._x)("Social Queue","text","nelio-content"),(0,a.jsx)($.Tooltip,{text:(0,q._x)("Total number of scheduled social messages.","text","nelio-content"),placement:"bottom",children:(0,a.jsx)("span",{className:"nelio-content-analytics-social-queue__help-icon",children:(0,a.jsx)($.Dashicon,{icon:"editor-help"})})})]}),(0,a.jsx)("div",{className:"nelio-content-analytics-social-queue__message-count",children:i-s}),(0,a.jsx)("div",{className:"nelio-content-analytics-social-queue__published-message-count",children:s!==i?(0,q.sprintf)(/* translators: 1 -> number of social messages sent, 2 -> total number of social messages */ /* translators: 1 -> number of social messages sent, 2 -> total number of social messages */
(0,q._x)("Sent: %1$d/%2$d","text","nelio-content"),s,i):(0,q.sprintf)(/* translators: 1 -> number of social messages sent */ /* translators: 1 -> number of social messages sent */
(0,q._x)("Sent: %d","text","nelio-content"),s)}),(0,a.jsx)("div",{className:"nelio-content-analytics-social-queue__actions",children:(0,a.jsx)($.Button,{variant:"secondary",size:"small",disabled:!o,onClick:r,children:(0,q._x)("Add Message","command","nelio-content")})})]})},rt=t=>l(e=>e(d.store).isResolving("getPostRelatedItems",[t])),lt=t=>l(e=>{const{canCurrentUserCreateMessagesRelatedToPost:n,getPost:o}=e(d.store);return n(o(t))}),ct=t=>l(e=>{const{getSocialMessage:n,getSocialMessageIdsRelatedToPost:o}=e(d.store),s=(0,u.map)(o(t),n);return{published:(0,u.filter)(s,{status:"publish"}).length,total:s.length}}),dt=t=>{const e=lt(t),n=l(e=>e(d.store).getPost(t)),o=(0,d.useFeatureGuard)("analytics/create-messages",e),{openNewSocialMessageEditor:s}=(0,r.useDispatch)(V.store);return o(()=>s({},{context:"analytics",post:n}))},ut=({postId:t})=>{var e;const n=(0,d.usePost)(t),o=(0,d.useAuthor)(null==n?void 0:n.author),s=l(t=>t(d.store).isGAConnected());if(!n)return null;const{title:i,excerpt:r,permalink:c,date:u,imageSrc:p}=n,m=null!==(e=null==o?void 0:o.name)&&void 0!==e?e:"",g=n.author;return(0,a.jsxs)("div",{className:it({"nelio-content-analytics-post":!0,"nelio-content-analytics-post--has-no-pageviews":!s}),children:[(0,a.jsxs)("div",{className:"nelio-content-analytics-post__post",children:[(0,a.jsx)("div",{className:"nelio-content-analytics-post__title",children:(0,a.jsx)($.ExternalLink,{href:c,children:i})}),(0,a.jsx)("div",{className:"nelio-content-analytics-post__excerpt",children:r||(0,a.jsx)("br",{})}),(0,a.jsx)("div",{className:"nelio-content-analytics-post__image",children:(0,a.jsx)("div",{className:"nelio-content-analytics-post__actual-image",style:{backgroundImage:p?`url(${p})`:void 0}})}),(0,a.jsxs)("div",{className:"nelio-content-analytics-post__author",children:[(0,a.jsx)(G.AuthorIcon,{className:"nelio-content-analytics-post__author-icon",authorId:g}),(0,a.jsx)("span",{className:"nelio-content-analytics-post__author-name",children:m||(0,q._x)("Unknown Author","text","nelio-content")})]}),(0,a.jsxs)("div",{className:"nelio-content-analytics-post__details",children:[n.typeName||n.type," • ",(0,W.dateI18n)((0,W.getSettings)().formats.date,u||"")]})]}),(0,a.jsx)(G.PostPageviewsAnalytics,{className:"nelio-content-analytics-post__pageviews",postId:t}),(0,a.jsx)(G.PostEngagementAnalytics,{className:"nelio-content-analytics-post__engagement",postId:t}),(0,a.jsx)(at,{className:"nelio-content-analytics-post__social-queue",postId:t})]})},pt=()=>{const t=gt(),e=ht(),n=mt(),o=!yt(),{loadPosts:s}=(0,r.useDispatch)(Y);return e?null:t&&(0,g.isEmpty)(n)?(0,a.jsx)("div",{className:"nelio-content-analytics-post-list",children:(0,a.jsx)(G.LoadingAnimation,{})}):(0,g.isEmpty)(n)?(0,a.jsxs)("div",{className:"nelio-content-analytics-post-list nelio-content-analytics-post-list--empty-list",children:[(0,a.jsx)($.Dashicon,{className:"nelio-content-analytics-post-list__no-posts-icon",icon:"info"}),(0,a.jsx)("div",{className:"nelio-content-analytics-post-list__no-posts-message",children:(0,q._x)("No posts matched your criteria","text","nelio-content")})]}):(0,a.jsxs)("div",{className:"nelio-content-analytics-post-list",children:[n.map(t=>(0,a.jsx)(ut,{postId:t},t)),(0,a.jsx)("div",{className:"nelio-content-analytics-post-list__action",children:o&&(0,a.jsx)($.Button,{disabled:t,isBusy:t,variant:"secondary",onClick:s,children:t?(0,q._x)("Loading…","text","nelio-content"):(0,q._x)("Load More","command","nelio-content")})})]})},mt=()=>l(t=>t(Y).getPostIds()||[]),gt=()=>l(t=>t(Y).isLoadingPosts()),ht=()=>l(t=>{const{getFilterCriteria:e}=t(Y),{periodMode:n,periodValue:o}=e(),{from:s,to:i}=o||{};return!("custom"!==n||s&&i)}),yt=()=>l(t=>t(Y).arePostsFullyLoaded()),vt=()=>{const t=l(t=>t(d.store).isGAConnected()),e=l(t=>t(Y).getFilterCriteria().sortBy),{sortBy:n,loadPosts:o}=(0,r.useDispatch)(Y),s=t=>{n(t),o()};return t?(0,a.jsx)("div",{className:"nelio-content-analytics-sorting-criterion",children:"pageviews"===e?(0,a.jsxs)(a.Fragment,{children:[(0,q._x)("Sorted by pageviews.","text","nelio-content")," ",(0,a.jsx)($.Button,{className:"nelio-content-analytics-sorting-criterion__button",variant:"link",onClick:()=>s("engagement"),children:(0,q._x)("Sort by engagement","command","nelio-content")})]}):(0,a.jsxs)(a.Fragment,{children:[(0,q._x)("Sorted by engagement.","text","nelio-content")," ",(0,a.jsx)($.Button,{className:"nelio-content-analytics-sorting-criterion__button",variant:"link",onClick:()=>s("pageviews"),children:(0,q._x)("Sort by pageviews","command","nelio-content")})]})}):null},_t=()=>(0,a.jsx)(c.StrictMode,{children:(0,a.jsxs)($.SlotFillProvider,{children:[(0,a.jsxs)("div",{className:"nelio-content-analytics",children:[(0,a.jsxs)("div",{className:"nelio-content-analytics__title",children:[(0,a.jsx)("h1",{className:"nelio-content-analytics__actual-title wp-heading-inline",children:(0,q._x)("Analytics","text","nelio-content")}),(0,a.jsx)(J,{})]}),(0,a.jsx)(vt,{}),(0,a.jsx)(pt,{})]}),(0,a.jsx)(V.SocialMessageEditor,{}),(0,a.jsx)(G.PremiumDialog,{}),(0,a.jsx)($.Popover.Slot,{})]})});function ft(t){const e=document.getElementById(t);var n,o;n=(0,a.jsx)(_t,{}),(o=e)&&(c.createRoot?(0,c.createRoot)(o).render(n):(0,c.render)(n,o)),function(){const{isGAConnected:t}=(0,r.select)(d.store);if(t())return;const{sortBy:e}=(0,r.dispatch)(Y);e("engagement")}(),function(){const{loadPosts:t}=(0,r.dispatch)(Y);t()}()}}},n={};function o(t){var s=n[t];if(void 0!==s)return s.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,o),i.exports}o.m=e,t=[],o.O=(e,n,s,i)=>{if(!n){var a=1/0;for(d=0;d<t.length;d++){for(var[n,s,i]=t[d],r=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every(t=>o.O[t](n[l]))?n.splice(l--,1):(r=!1,i<a&&(a=i));if(r){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[n,s,i]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={6475:0,9966:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var s,i,[a,r,l]=n,c=0;if(a.some(e=>0!==t[e])){for(s in r)o.o(r,s)&&(o.m[s]=r[s]);if(l)var d=l(o)}for(e&&e(n);c<a.length;c++)i=a[c],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return o.O(d)},n=globalThis.webpackChunkNelioContent=globalThis.webpackChunkNelioContent||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var s=o.O(void 0,[9966],()=>o(5785));s=o.O(s);var i=NelioContent="undefined"==typeof NelioContent?{}:NelioContent;for(var a in s)i[a]=s[a];s.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();